% Copyright (c) 2013â€“2014, authors of "Core Econometrics;" a
% complete list of authors is available in the file AUTHORS.tex.

% Permission is granted to copy, distribute and/or modify this
% document under the terms of the GNU Free Documentation License,
% Version 1.3 or any later version published by the Free Software
% Foundation; with no Invariant Sections, no Front-Cover Texts, and no
% Back-Cover Texts.  A copy of the license is included in the file
% LICENSE.tex and is also available online at
% <http://www.gnu.org/copyleft/fdl.html>.

\chapter{Linear regression}

\section{Asymptotic properties of OLS}

\begin{itemize}[leftmargin=0pt]
\item Notice that the OLS estimator can be written as a function of
  averages:
  \begin{equation*}
    \betah = \beta + \big( (1/n) \sum_{i=1}^n x_i x_i' \big)^{-1}
    (1/n) \sum_{i=1}^n x_i \vep_i.
  \end{equation*}
  So it is easy to analyze the asymptotic behavior of $\betah$ whenever
  $(1/n) \sum_{i=1}^n x_i x_i'$ obeys an LLN and $(1/n) \sum_{i=1}^n x_i \vep_i$
  obeys an LLN or CLT.

  If we maintain the assumption that the observations are independent
  but not necessarily identically distributed, which is a common
  working assumption in cross-sectional economics, we can ensure
  convenient asymptotic properties with the following technical
  conditions:
  \begin{asmp}\label{xmoments}
    The regressors $\{X_i\}$ are independent with uniformly bounded
    fourth moments and the $\E x_i x_i'$ are uniformly positive
    definite.
  \end{asmp}
  Under Assumption~\ref{xmoments},
  \begin{equation*}
    (1/n) \sum_{i=1}^n x_i x_i' \to^p Q
  \end{equation*}
  where $Q = \lim_{n\to\infty} (1/n) \sum_{i=1}^n \E x_i x_i'$.

  \begin{asmp}~\label{epmoments}
    The r.v.s $\{x_i \vep_i\}$ are independent and mean zero with
    uniformly bounded $2 + \delta$ moments and uniformly positive definite
    variances.
  \end{asmp}
  Under Assumption~\ref{epmoments},
  \begin{equation*}
    (1/\sqrt{n}) \sum_{i=1}^n x_i \vep_i \to^d N(0, V)
  \end{equation*}
  where $V = \lim_{n\to\infty} (1/n) \sum_{i=1}^n \E x_i x_i' \vep_i^2$

\item Now, under Assumptions~\ref{xmoments} and~\ref{epmoments}, it is
  straightforward to show that the OLS estimator is consistent and
  asymptotically normal.
  \begin{defn}
    An estimator $\thetah_n$ of the parameter $\theta$ is \emph{consistent} if
    $\thetah_n \to \theta$ in probability as $n \to \infty$.
  \end{defn}
  Consistency can be viewed as the minimal property that an estimator
  should have: if you have arbitrarily many observations, the
  estimator should be arbitrarily close to the true
  parameter.\footnote{Note that econometricians will sometimes use
    nonstandard asymptotic theory to work with approximations that
    break consistency: see, e.g., the weak instruments literature.}

\item So, assume that Assumptions~\ref{xmoments} and~\ref{epmoments}
  hold.  Then
  \begin{equation*}
    \betah 
    = \beta + \big( (1/n) \sum_{i=1}^n x_i x_i' \big)^{-1}
       (1/n) \sum_{i=1}^n x_i \vep_i
    = \beta + \big( (1/n) \sum_{i=1}^n x_i x_i' \big)^{-1} o_p.
  \end{equation*}
  and, since $(1/n) \sum_{i=1}^n x_i x_i' \to^p Q$ and $Q$ is invertible by
  assumption, we have $\betah = \beta + o_p$.

\item For asymptotic normality, we have
  \begin{equation*}
    \sqrt{n} (\betah - \beta)
    = \big( (1/n) \sum_{i=1}^n x_i x_i' \big)^{-1}
      (1/\sqrt{n}) \sum_{i=1}^n x_i \vep_i \to^d Q^{-1} Z
  \end{equation*}
  where $Z \sim N(0, V)$, so $\sqrt{n} (\betah - \beta) \sim^a N(0, Q^{-1} V
  Q^{-1})$, where ``$\sim^a$'' designates asymptotic distribution.

\item This asymptotic distribution is different than the finite sample
  distribution.  Specifically, the variance is different.  In our
  finite sample results, we assumed conditional homoskedasticity;
  namely that $\var(\vep_i \mid X) = \sigma^2$ for all $i$.  Making that
  assumption here changes $V$:
  \begin{align*}
    V
    &= \lim_{n \to \infty} (1/n) \sum_{i=1}^n \E x_i x_i' \vep_i^2 \\
    &= \lim_{n \to \infty} (1/n) \sum_{i=1}^n \E \big( x_i x_i' \E(\vep_i^2 \mid X) \big) \\
    &= \lim_{n \to \infty} (1/n) \sum_{i=1}^n \E( x_i x_i' ) \sigma^2 \\
    &= \sigma^2 Q.
  \end{align*}
  Then we have $\sqrt{n} (\betah - \beta) \sim^a N(0, \sigma^2 Q^{-1})$, which is the
  limit of the finite sample distribution under homoskedasticity.  The
  proof that $(1/n) X'X \to Q$ in probability has been done, so it
  remains to show that $s^2 \to \sigma^2$ in probability:
  \begin{align*}
    s^2 &= (1/(n-k)) \sum_i (y_i - x_i'\betah)^2 \\
    &= (1/(n-k)) \sum_i (\vep_i - x_i'(\betah - \beta))^2 \\
    &= (1/(n-k)) \sum_i (\vep_i^2 - 2 \vep_i x_i'(\betah-\beta) + (x_i'(\betah-\beta))^2) \\
    &= (1/(n-k)) \sum_i \vep_i^2
       - 2 (\betah - \beta)' (1/(n-k)) \sum_i  x_i \vep_i
       + (\betah - \beta)' (1/(n-k)) \sum_i x_i x_i' (\betah - \beta) \\
    &= (1/n) \sum_i \vep_i^2 + o_p(1) o_p(1) + o_p(1)'O_p(1)o_p(1) \\
    &= (1/n) \sum_i \vep_i^2 + o_p(1).
  \end{align*}
  And $(1/n) \sum_i \vep_i^2 \to \sigma^2$ through the LLN.

\end{itemize}

\section{Hypothesis testing}

\begin{itemize}[leftmargin=0pt]

\item To be able to use this asymptotic approximation, we need to
  estimate the parameters $Q$ and $V$.  We already know an estimator
  for $Q$, simply $(1/n) \sum_{i=1}^n x_i x_i'$ which is consistent under
  Assumption~\ref{xmoments}.  But we don't observe $\vep_i$, so the
  obviously correct average $(1/n) \sum_{i=1}^n \vep_i^2 x_i x_i'$ is not
  an option.

  Of course, since we know $(1/n) \sum_{i=1}^n \vep_i^2 x_i x_i' \to^p V$
  under Assumption~\ref{epmoments}\footnote{Add the argument later.}
  it suffices to find a quantity that converges to $(1/n) \sum_{i=1}^n
  \vep_i^2 x_i x_i'$ in probability.  One option to replace $\vep_i$ with
  the OLS residual $\veph_i$.  This gives the estimator
  \begin{equation*}
    \Vh = (1/n) \sum_{i=1}^n \veph_i^2 x_i x_i',
  \end{equation*}
  which was first proposed in the econometrics literature by
  \citet{Whi80}.

\item Let's define $W_n = (1/n) \sum_{i=1}^n x_i x_i' \vep_i^2$.  We can
  rewrite the difference between $W_n$ and $\Vh$ as
  \begin{align*}
    \Vh - W_n
    &= (1/n) \sum_{i=1}^n x_i x_i' (\veph^2_i - \vep_i^2) \\
    &= (1/n) \sum_{i=1}^n x_i x_i' (x_i'(\betah - \beta))^2
    - (2/n) \sum_{i=1}^n  x_i x_i' \vep_i x_i'(\betah - \beta))
  \end{align*}

  Now, if we look at the $(j,k)$ element of the first matrix, we see
  \begin{equation*}
    (1/n) \sum_{i=1}^n x_{ij} x_{ik}(x_i'(\betah - \beta))^2 =
    (\betah - \beta)' \big((1/n) \sum_{i=1}^n x_i x_{ij} x_{ik} x_{i}'\big) (\betah- \beta).
  \end{equation*}
  Under usual conditions, the term inside the sum is going to converge
  to its average and each $\betah - \beta$ is going to converge to zero in
  probability.  So this term is $o_p$.

  If we look at the $(j,k)$ element of the second matrix, we see
  \begin{equation*}
    (1/n) \sum_{i=1}^n x_{ij} x_{ik}(\vep_i x_i'(\betah - \beta)) =
    \big((1/n) \sum_{i=1}^n \vep_i x_{ij} x_{ik} x_{i}'\big) (\betah- \beta).
  \end{equation*}
  Again, the term inside the sum converges to its average (zero, in
  this case) and $\betah - \beta$ converges in probability to zero.

  Consequently, $\Vh = W_n + o_p = V + o_p$.

\item We can test linear restrictions on a single coefficient with a
  modification of the \ttest.  Instead of normalizing with the $(j,j)$
  element of $n \cdot s^2 (X'X)^{-1}$, however, we need to normalize with
  the $(j,j)$ element of $\Qh^{-1} \Vh \Qh^{-1}$ (define $\Omegah =
  \Qh^{-1} \Vh \Qh^{-1}$) .  So, under the null hypothesis $\beta_j = b_0$,
  we have
  \begin{equation*}
    \sqrt{n} (\betah_j - b_0) / \Omegah_{jj}^{1/2} =
    \sqrt{n} (\betah_j - b_0) / \Omega_{jj}^{1/2} \times (\Omega_{jj} / \Omegah_{jj})^{1/2}.
  \end{equation*}
  Since $\sqrt{n} (\betah_j - b_0) / \Omega_{jj}^{1/2} \to N(0, 1)$ in
  distribution and $(\Omega_{jj} / \Omegah_{jj})^{1/2} \to 1$ in probability,
  \begin{equation*}
    \sqrt{n} (\betah_j - b_0) / \Omegah_{jj}^{1/2} \to^d N(0,1)
  \end{equation*}

\item Under conditional homoskedasticity, we obviously can use $n \cdot s^2
  (X'X)^{-1}$ instead of $\Qh^{-1} \Vh \Qh^{-1}$.

\item Also, notice that the $t_{n-k}$ distribution converges to a
  standard normal as well.
  \begin{equation*}
    t_{n-k} =^d \frac{Z_0}{\sqrt{(1/(n-k)) \sum_{i=1}^{n-k} Z_i^2}}
  \end{equation*}
  where the $Z_i$ are independent standard normal random variables.
  Since the denominator obeys an LLN and converges in probability to
  1, we have $t_{n-k} \to N(0,1)$ in distribution.

  This means that we can compare the test statistic $\sqrt{n} (\betah_j -
  b_0) / \Omegah_{jj}^{1/2}$ to standard normal critical values or to
  critical values from the $t_{n-k}$ distribution.  These approaches
  will almost always give you the same answer, but the $t_{n-k}$
  critical values will always be slightly larger.

  If the two critical values don't give you the same answer, it is
  probably best to be conservative and use the larger critical values
  (which will lead you to not reject the null hypothesis).  The
  discrepancy is telling you that you don't have enough observations
  to get reliable asymptotic approximations, so you should probably
  play it safe and not reject.

\item We can extend the \ftest\ in the same way to test several linear
  restrictions.  But an easier way to motivate the statistic is to
  observe that, if the null hypothesis $R \beta = q$ holds, where $R$ and
  $q$ are both known to the researcher,\footnote{Assume that $q$ has
  $p$ elements and that $R$ has full rank.} then
  \begin{equation*}
    \sqrt{n} (R \betah - q) \to^d N(0, R Q^{-1} V Q^{-1} R').
  \end{equation*}
  Using the previous arguments, we have
  \begin{equation*}
    \sqrt{n} (R \Omegah R')^{-1/2} (R \betah - q) \to^d N(0, I)
  \end{equation*}
  and so
  \begin{equation*}
    n (R \betah - q)' (R \Omegah R')^{-1} (R \betah - q) \to^d \chi^2_p.
  \end{equation*}
  This is called the Wald test.

  If we are willing to assume conditional homoskedasticity, then $\Omegah$
  becomes $n \cdot s^2 (X'X)^{-1}$ and the Wald test statistic becomes a
  scaled \ftest.

\item Notice that we can make the same argument as above: since the
  $F_{p,n-k}$ converges to a $\chi^2_p$ distribution as $n-k \to \infty$, we can
  use either $\chi^2$ or $F$ critical values for our test statistic.  Just
  like with the \ttest, the $F$ critical values will be somewhat more
  conservative (here it can actually make a noticeable difference), so
  you should use them.

\item So far, we've discussed testing linear restrictions on the
  coefficients.  But we can also test nonlinear restrictions of the
  form $c(\beta) = q$, where $c$ is a function from $\RR^{k+1}$ to
  $\RR^p$.

  If we are willing to specify a distribution for the errors, we could
  crank through the algebra and derive the distribution of $c(\betah)$.

  But we can also use the delta method if $c$ is differentiable with
  nonzero continuous derivative at $\beta$.  Let $C(\beta) = (\partial/\partial\beta) c(\beta)$ and
  assume that $C(\beta)$ has full rank.  Then
  \begin{equation*}
    \sqrt{n} (c(\betah) - q) \to^d N(0, C(\beta)' \Omega C(\beta))
  \end{equation*}
  and, since $C(\betah) \to^p C(\beta)$ as $n \to \infty$ by continuity, we have
  \begin{equation*}
    \sqrt{n} (C(\betah)' \Omegah C(\betah))^{-1/2} (c(\betah) - q) \to^d N(0, I)
  \end{equation*}
  and
  \begin{equation*}
    n (c(\betah) - q)' (C(\betah)' \Omegah C(\betah))^{-1} (c(\betah) - q) \to^d \chi^2_p.
  \end{equation*}

  Again, $\Omegah$ can be estimated under homoskedasticity if the
  researcher believes that assumption is justified.

  If $C(\beta)$ does not have full rank, the same approach can work but it
  will be more awkward.

\item We could also take another route.  Instead of correcting the
  asymptotic distribution of the OLS estimator, we could account for
  heteroskedasticity in estimating $\beta$.  This would give us a feasible
  version of the GLS estimator discussed earlier.

  So, suppose that $Y = X \beta + \vep$ and $\vep \sim (0, \Sigma)$ given $X$ (where
  $\Sigma$ is diagonal for now for convenience).
  Further assume that $\Sigma$ has only a few unknown parameters,
  so
  \begin{equation*}
    \E(\vep^2_i \mid X) = z_i'\alpha
  \end{equation*}
  where $z_i$ is some function of the regressors.  Since $\veph_i$ is
  consistent for $\vep_i$, we can regress $\veph^2_i$ on $z_i$ to
  estimate $\alpha$.

  The two-step process is
  \begin{enumerate}
  \item Regress $Y$ on $X$ with OLS to get $\veph$
  \item Regress $\veph$ on $Z$ to estimate $\alpha$
  \item Regress $Y_i/w_i$ on $X_i/w_i$ to estimate $\betah_{FGLS}$ where
    $w_i = \sqrt{z_i'\alphah}$
  \end{enumerate}

  If we let $\Sigmah$ be the estimate of $\Sigma$ that uses $\alphah$, consistency
  of $\alphah$ ensures that $\Sigmah$ behaves asymptotically like $\Sigma$.  All of
  the asymptotic results from the GLS estimator then automatically
  apply to the Feasible GLS estimator.  Note that the finite sample
  properties of the GLS estimator (efficiency via Gauss-Markov, for
  example) do not necessarily hold.

\item We can also test for heteroskedasticity.  Note that $\betah$ is
  consistent even under heteroskedasticity, so $\veph_i \to \vep_i$ for
  each $i$.  If $\sigma^2_i$ is different for different individuals, it
  implies that $\vep^2_i$ should be correlated with $x_i$, so we might
  regress $\vep^2_i$ on $x_i$ and do an F-test for the significance of
  the overall regression?

  More formally, the null hypothesis of homoskedasticity can be
  expressed as
  \begin{equation*}
    H_0: \quad \sigma^2_i = \sigma^2 \qquad i = 1,...,n.
  \end{equation*}
  If the null hypothesis is true, then $n s^2 (X'X)^{-1} \to \Omega$
  in probability as $n \to \infty$,
  so
  \begin{equation*}
    (1/n) \sum_{i=1}^n (\veph^2_i - s^2) x_i x_i' \to^p 0.
  \end{equation*}
  If the null is false, this convergence fails.  Since this looks like
  an average, we can apply the CLT to get critical values.

  Let $\psi_i$ denote the vector of unique elements of $x_ix_i'$, along
  with a constant term (if not in $x_i$), and let $p$ denote the
  length of $\psi_i$.  One can show under some assumptions that
  \begin{equation*}
    \sqrt{n} \big( \sum_{i=1}^n (\veph^2_i - s^2) \psi_i \big) \to^d N(0, W)
  \end{equation*}
  where $W$ can be estimated.  But an easier way to test for
  heteroskedasticity is through an equivalent but simpler procedure
  (derived by \citealp{Whi80}):
  
  \begin{enumerate}
  \item Regress $y_i$ on $x_i$ and save the OLS residuals.
  \item Regress $\veph_i$ on $\psi_i$ and calculate the $R^2$
    from this regression.
  \item $n R^2$ is asymptotically $\chi^2_{p-1}$ under the null
    hypothesis.
  \end{enumerate}

\end{itemize}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../core_econometrics"
%%% End: 
